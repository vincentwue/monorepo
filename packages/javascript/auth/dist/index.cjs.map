{"version":3,"file":"index.cjs","sources":["../src/utils/ory.ts","../src/components/AuthFlow.tsx","../src/components/Login.tsx","../src/components/Registration.tsx","../src/components/Recovery.tsx","../src/components/useSession.tsx","../src/components/RequireAuth.tsx"],"sourcesContent":["import type { FlowType } from \"../types/flows\"\n\nconst DEFAULT_BROWSER_URL = \"http://localhost:4433\"\nconst DEFAULT_PUBLIC_API_URL = DEFAULT_BROWSER_URL\n\nexport const getOryBrowserUrl = () =>\n    import.meta.env?.VITE_ORY_BROWSER_URL?.replace(/\\/$/, \"\") || DEFAULT_BROWSER_URL\n\nexport const getOryPublicApiBaseUrl = () =>\n    import.meta.env?.VITE_ORY_PUBLIC_API_URL?.replace(/\\/$/, \"\") || DEFAULT_PUBLIC_API_URL\n\nexport const getRedirectUrl = (flowType: FlowType) => {\n    const env = import.meta.env\n    if (flowType === \"login\") return env?.VITE_AUTH_LOGIN_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/\"\n    if (flowType === \"registration\")\n        return env?.VITE_AUTH_REGISTRATION_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/\"\n    return env?.VITE_AUTH_RECOVERY_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/login\"\n}\n\nexport const openOryBrowserFlow = (flowType: FlowType, returnTo?: string) => {\n    const base = getOryBrowserUrl()\n    if (typeof window === \"undefined\") return\n    const url = new URL(`${base}/self-service/${flowType}/browser`)\n    if (returnTo) url.searchParams.set(\"return_to\", returnTo)\n    window.location.href = url.toString()\n}\n","import axios from \"axios\"\nimport type { FormEvent, ReactNode } from \"react\"\nimport { useEffect, useMemo, useState } from \"react\"\nimport { getOryBrowserUrl, getRedirectUrl, openOryBrowserFlow } from \"../utils/ory\"\nimport type { FlowType } from \"../types/flows\"\nimport \"../styles.css\"\n\ntype OryNode = {\n    attributes: {\n        name: string\n        type: string\n        value?: string | number | boolean\n        required?: boolean\n        disabled?: boolean\n        autocomplete?: string\n        pattern?: string\n        minLength?: number\n        maxLength?: number\n        placeholder?: string\n    }\n    meta?: {\n        label?: {\n            text?: string\n        }\n    }\n    messages?: { id: string | number; text: string }[]\n}\n\ntype OryFlow = {\n    id: string\n    ui: {\n        action: string\n        method: string\n        nodes: OryNode[]\n        messages?: { id: string | number; text: string }[]\n    }\n}\n\nconst DEFAULT_SUBMIT_LABEL: Record<FlowType, string> = {\n    login: \"Continue\",\n    registration: \"Create account\",\n    recovery: \"Send recovery link\",\n}\n\nexport interface AuthFlowProps {\n    flowType: FlowType\n    title?: string\n    description?: string\n    submitLabel?: string\n    className?: string\n    redirectTo?: string\n    footer?: ReactNode\n    onSuccess?: (payload: unknown) => void\n    onError?: (error: unknown) => void\n}\n\nexport const AuthFlow = ({\n    flowType,\n    title,\n    description,\n    submitLabel,\n    className,\n    redirectTo,\n    footer,\n    onError,\n    onSuccess,\n}: AuthFlowProps) => {\n    const [flow, setFlow] = useState<OryFlow | null>(null)\n    const [loading, setLoading] = useState(true)\n    const [formValues, setFormValues] = useState<Record<string, string>>({})\n    const [localError, setLocalError] = useState<string | null>(null)\n    const baseUrl = useMemo(() => getOryBrowserUrl(), [])\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return\n        let cancelled = false\n        const fetchFlow = async () => {\n            setLoading(true)\n            setLocalError(null)\n            try {\n                const params = new URLSearchParams(window.location.search)\n                const flowId = params.get(\"flow\")\n                if (!flowId) {\n                    openOryBrowserFlow(flowType, window.location.href)\n                    return\n                }\n\n                const res = await axios.get<OryFlow>(`${baseUrl}/self-service/${flowType}/flows`, {\n                    params: { id: flowId },\n                    withCredentials: true,\n                })\n\n                if (!cancelled) {\n                    setFlow(res.data)\n                }\n            } catch (error: any) {\n                console.error(`Failed to load ${flowType} flow`, error)\n                if (error?.response?.status === 404 || error?.response?.status === 410) {\n                    openOryBrowserFlow(flowType, window.location.href)\n                    return\n                }\n                setLocalError(\"Unable to reach the Ory backend. Check your env values.\")\n                onError?.(error)\n            } finally {\n                if (!cancelled) {\n                    setLoading(false)\n                }\n            }\n        }\n\n        fetchFlow()\n        return () => {\n            cancelled = true\n        }\n    }, [baseUrl, flowType, onError])\n\n    useEffect(() => {\n        if (!flow) return\n        setFormValues((prev) => {\n            const next = { ...prev }\n            flow.ui.nodes.forEach((node) => {\n                const { name, value } = node.attributes\n                if (value !== undefined && next[name] === undefined) {\n                    next[name] = String(value)\n                }\n            })\n            return next\n        })\n    }, [flow])\n\n    const handleChange = (key: string, value: string) => {\n        setFormValues((prev) => ({ ...prev, [key]: value }))\n    }\n\n    const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {\n        event.preventDefault()\n        if (!flow) return\n\n        const payload = new URLSearchParams()\n        Object.entries(formValues).forEach(([key, value]) => {\n            payload.set(key, value)\n        })\n\n        flow.ui.nodes\n            .filter((node) => node.attributes.type === \"hidden\")\n            .forEach((node) => {\n                const { name, value } = node.attributes\n                if (!name || value === undefined) return\n                if (!payload.has(name)) {\n                    payload.set(name, String(value))\n                }\n            })\n\n        const csrfNode = flow.ui.nodes.find((node) => node.attributes.name === \"csrf_token\")\n        if (csrfNode && !payload.get(\"csrf_token\") && csrfNode.attributes.value) {\n            payload.set(\"csrf_token\", String(csrfNode.attributes.value))\n        }\n\n        if (!payload.get(\"method\")) {\n            const methodNode = flow.ui.nodes.find((node) => node.attributes.name === \"method\")\n            if (methodNode?.attributes.value) {\n                payload.set(\"method\", String(methodNode.attributes.value))\n            } else if (flowType === \"login\") {\n                payload.set(\"method\", \"password\")\n            }\n        }\n\n        try {\n            const response = await axios.post(flow.ui.action, payload, {\n                withCredentials: true,\n                headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n            })\n\n            if (onSuccess) {\n                onSuccess(response.data)\n                return\n            }\n\n            const target = redirectTo || getRedirectUrl(flowType)\n            if (target && typeof window !== \"undefined\") {\n                window.location.assign(target)\n            }\n        } catch (error: any) {\n            console.error(\"Auth flow submission failed\", error)\n            onError?.(error)\n\n            const data = error?.response?.data\n            if (data?.ui) {\n                setFlow(data)\n                return\n            }\n\n            if (error?.response?.status === 410) {\n                openOryBrowserFlow(flowType, typeof window !== \"undefined\" ? window.location.href : undefined)\n                return\n            }\n\n            setLocalError(\"The credentials were rejected. Please try again.\")\n        }\n    }\n\n    if (loading || !flow) {\n        return (\n            <div className={`ory-auth-shell ${className ?? \"\"}`}>\n                <div className=\"ory-auth-panel\">\n                    <p className=\"ory-auth-loading\">Loading {flowType} flow...</p>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className={`ory-auth-shell ${className ?? \"\"}`}>\n            <form className=\"ory-auth-panel\" onSubmit={handleSubmit}>\n                {title && <h2 className=\"ory-auth-title\">{title}</h2>}\n                {description && <p className=\"ory-auth-description\">{description}</p>}\n\n                {localError && <p className=\"ory-auth-error\">{localError}</p>}\n\n                {flow.ui.messages?.length ? (\n                    <div className=\"ory-auth-error\">\n                        {flow.ui.messages.map((message) => (\n                            <p key={message.id}>{message.text}</p>\n                        ))}\n                    </div>\n                ) : null}\n\n                {flow.ui.nodes.map((node) => {\n                    const attr = node.attributes\n                    const key = `${flow.id}-${attr.name}`\n\n                    if (attr.type === \"hidden\") {\n                        return <input key={key} type=\"hidden\" name={attr.name} value={String(attr.value ?? \"\")} />\n                    }\n\n                    if (attr.type === \"submit\" || attr.type === \"button\") {\n                        return null\n                    }\n\n                    const label = node.meta?.label?.text || attr.name\n                    const currentValue = formValues[attr.name] ?? \"\"\n\n                    return (\n                        <div key={key} className=\"ory-auth-field\">\n                            <label className=\"ory-auth-label\" htmlFor={attr.name}>\n                                {label}\n                            </label>\n                            <input\n                                id={attr.name}\n                                name={attr.name}\n                                type={attr.name.toLowerCase().includes(\"email\") ? \"email\" : attr.type}\n                                className=\"ory-auth-input\"\n                                placeholder={attr.placeholder}\n                                autoComplete={attr.autocomplete}\n                                disabled={attr.disabled}\n                                required={attr.required}\n                                value={currentValue}\n                                onChange={(event) => handleChange(attr.name, event.target.value)}\n                            />\n                            {node.messages?.map((message) => (\n                                <p key={message.id} className=\"ory-auth-field-message\">\n                                    {message.text}\n                                </p>\n                            ))}\n                        </div>\n                    )\n                })}\n\n                <button type=\"submit\" className=\"ory-auth-submit\">\n                    {submitLabel || DEFAULT_SUBMIT_LABEL[flowType]}\n                </button>\n\n                {footer && <div className=\"ory-auth-footer\">{footer}</div>}\n            </form>\n        </div>\n    )\n}\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface LoginProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultLoginFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"registration\")}>\n            Create account\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"recovery\")}>\n            Forgot password?\n        </button>\n    </div>\n)\n\nexport const Login = ({\n    title = \"Sign in\",\n    description = \"Enter your credentials to continue with your subscription.\",\n    submitLabel = \"Continue\",\n    footer,\n    ...rest\n}: LoginProps) => (\n    <AuthFlow\n        flowType=\"login\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultLoginFooter />}\n        {...rest}\n    />\n)\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface RegistrationProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultRegistrationFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"login\")}>\n            Already have an account?\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"recovery\")}>\n            Recover access\n        </button>\n    </div>\n)\n\nexport const Registration = ({\n    title = \"Create your account\",\n    description = \"Provision access to the shared Ory identity platform.\",\n    submitLabel = \"Create account\",\n    footer,\n    ...rest\n}: RegistrationProps) => (\n    <AuthFlow\n        flowType=\"registration\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultRegistrationFooter />}\n        {...rest}\n    />\n)\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface RecoveryProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultRecoveryFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"login\")}>\n            Back to login\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"registration\")}>\n            Need an account?\n        </button>\n    </div>\n)\n\nexport const Recovery = ({\n    title = \"Recover access\",\n    description = \"Send yourself a magic link to reset your password.\",\n    submitLabel = \"Send recovery link\",\n    footer,\n    ...rest\n}: RecoveryProps) => (\n    <AuthFlow\n        flowType=\"recovery\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultRecoveryFooter />}\n        {...rest}\n    />\n)\n","import { useEffect, useState } from \"react\"\nimport axios from \"axios\"\nimport { getOryPublicApiBaseUrl } from \"../utils/ory\"\n\nexport interface OrySession {\n    id: string\n    [key: string]: unknown\n}\n\nexport interface UseSessionResult {\n    session: OrySession | null\n    loading: boolean\n    error: unknown | null\n}\n\nexport const useSession = (): UseSessionResult => {\n    const [session, setSession] = useState<OrySession | null>(null)\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState<unknown | null>(null)\n\n    useEffect(() => {\n        let active = true\n\n        const fetchSession = async () => {\n            try {\n                const baseUrl = getOryPublicApiBaseUrl()\n                const response = await axios.get<OrySession>(`${baseUrl}/sessions/whoami`, {\n                    withCredentials: true,\n                })\n                if (!active) return\n                setSession(response.data)\n                setError(null)\n            } catch (err: unknown) {\n                if (!active) return\n                if (axios.isAxiosError(err) && (err.response?.status === 401 || err.response?.status === 403)) {\n                    setSession(null)\n                    setError(null)\n                } else {\n                    setSession(null)\n                    setError(err)\n                }\n            } finally {\n                if (active) {\n                    setLoading(false)\n                }\n            }\n        }\n\n        fetchSession()\n\n        return () => {\n            active = false\n        }\n    }, [])\n\n    return { session, loading, error }\n}\n","import type { JSX } from \"react\"\nimport { useSession } from \"./useSession\"\n\nexport interface RequireAuthProps {\n    children: JSX.Element\n    redirectTo?: string\n    loadingFallback?: JSX.Element\n}\n\n/**\n * RequireAuth\n *\n * - While loading: shows a small fallback.\n * - If unauthenticated: does a full-page redirect (window.location.href)\n *   to `redirectTo` (which can be absolute, e.g. http://localhost:5173/..., or\n *   a path like \"/login\").\n * - If authenticated: renders children.\n *\n * NOTE: We intentionally do NOT use React Router's <Navigate> here to avoid\n * cross-origin history.replaceState issues when redirecting to the auth-ui\n * (different port / origin).\n */\nexport const RequireAuth = ({\n    children,\n    redirectTo = \"/login\",\n    loadingFallback,\n    skipRedirect = false,\n}: RequireAuthProps) => {\n    const { session, loading } = useSession()\n\n    if (loading) {\n        return loadingFallback ?? <p>Checking session...</p>\n    }\n\n    if (!session && !skipRedirect) {\n        const target = redirectTo ?? \"/login\"\n\n        let finalUrl: string\n\n        if (/^https?:\\/\\//i.test(target)) {\n            // Absolute URL (can be different origin, e.g. auth-ui on 5173)\n            finalUrl = target\n        } else if (target.startsWith(\"/\")) {\n            // Path on the current origin\n            finalUrl = `${window.location.origin}${target}`\n        } else {\n            // Relative segment, normalize to \"/segment\"\n            finalUrl = `${window.location.origin}/${target}`\n        }\n\n\n        window.location.href = finalUrl\n        return null\n    }\n\n    return children\n}\n"],"names":["DEFAULT_BROWSER_URL","DEFAULT_PUBLIC_API_URL","getOryBrowserUrl","__vite_import_meta_env__","getOryPublicApiBaseUrl","getRedirectUrl","flowType","env","openOryBrowserFlow","returnTo","base","url","DEFAULT_SUBMIT_LABEL","AuthFlow","title","description","submitLabel","className","redirectTo","footer","onError","onSuccess","flow","setFlow","useState","loading","setLoading","formValues","setFormValues","localError","setLocalError","baseUrl","useMemo","useEffect","cancelled","flowId","res","axios","error","prev","next","node","name","value","handleChange","key","handleSubmit","event","payload","csrfNode","methodNode","response","target","data","jsx","jsxs","message","attr","label","currentValue","DefaultLoginFooter","Login","rest","DefaultRegistrationFooter","Registration","DefaultRecoveryFooter","Recovery","useSession","session","setSession","setError","active","err","RequireAuth","children","loadingFallback","skipRedirect","finalUrl"],"mappings":"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"}