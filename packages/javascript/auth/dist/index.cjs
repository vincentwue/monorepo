"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),b=require("axios"),f=require("react"),R={},L="http://localhost:4433",$=L,x=()=>R?.VITE_ORY_BROWSER_URL?.replace(/\/$/,"")||L,A=()=>R?.VITE_ORY_PUBLIC_API_URL?.replace(/\/$/,"")||$,N=s=>{const r=R;return s==="login"?r?.VITE_AUTH_LOGIN_REDIRECT||r?.VITE_AUTH_SUCCESS_REDIRECT||"/":s==="registration"?r?.VITE_AUTH_REGISTRATION_REDIRECT||r?.VITE_AUTH_SUCCESS_REDIRECT||"/":r?.VITE_AUTH_RECOVERY_REDIRECT||r?.VITE_AUTH_SUCCESS_REDIRECT||"/login"},m=(s,r)=>{const c=x();if(typeof window>"u")return;const u=new URL(`${c}/self-service/${s}/browser`);r&&u.searchParams.set("return_to",r),window.location.href=u.toString()},B={login:"Continue",registration:"Create account",recovery:"Send recovery link"},v=({flowType:s,title:r,description:c,submitLabel:u,className:h,redirectTo:p,footer:d,onError:y,onSuccess:g})=>{const[l,E]=f.useState(null),[k,S]=f.useState(!0),[j,C]=f.useState({}),[U,_]=f.useState(null),I=f.useMemo(()=>x(),[]);f.useEffect(()=>{if(typeof window>"u")return;let a=!1;return(async()=>{S(!0),_(null);try{const n=new URLSearchParams(window.location.search).get("flow");if(!n){m(s,window.location.href);return}const o=await b.get(`${I}/self-service/${s}/flows`,{params:{id:n},withCredentials:!0});a||E(o.data)}catch(i){if(console.error(`Failed to load ${s} flow`,i),i?.response?.status===404||i?.response?.status===410){m(s,window.location.href);return}_("Unable to reach the Ory backend. Check your env values."),y?.(i)}finally{a||S(!1)}})(),()=>{a=!0}},[I,s,y]),f.useEffect(()=>{l&&C(a=>{const e={...a};return l.ui.nodes.forEach(i=>{const{name:n,value:o}=i.attributes;o!==void 0&&e[n]===void 0&&(e[n]=String(o))}),e})},[l]);const F=(a,e)=>{C(i=>({...i,[a]:e}))},O=async a=>{if(a.preventDefault(),!l)return;const e=new URLSearchParams;Object.entries(j).forEach(([n,o])=>{e.set(n,o)}),l.ui.nodes.filter(n=>n.attributes.type==="hidden").forEach(n=>{const{name:o,value:w}=n.attributes;!o||w===void 0||e.has(o)||e.set(o,String(w))});const i=l.ui.nodes.find(n=>n.attributes.name==="csrf_token");if(i&&!e.get("csrf_token")&&i.attributes.value&&e.set("csrf_token",String(i.attributes.value)),!e.get("method")){const n=l.ui.nodes.find(o=>o.attributes.name==="method");n?.attributes.value?e.set("method",String(n.attributes.value)):s==="login"&&e.set("method","password")}try{const n=await b.post(l.ui.action,e,{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(g){g(n.data);return}const o=p||N(s);o&&typeof window<"u"&&window.location.assign(o)}catch(n){console.error("Auth flow submission failed",n),y?.(n);const o=n?.response?.data;if(o?.ui){E(o);return}if(n?.response?.status===410){m(s,typeof window<"u"?window.location.href:void 0);return}_("The credentials were rejected. Please try again.")}};return k||!l?t.jsx("div",{className:`ory-auth-shell ${h??""}`,children:t.jsx("div",{className:"ory-auth-panel",children:t.jsxs("p",{className:"ory-auth-loading",children:["Loading ",s," flow..."]})})}):t.jsx("div",{className:`ory-auth-shell ${h??""}`,children:t.jsxs("form",{className:"ory-auth-panel",onSubmit:O,children:[r&&t.jsx("h2",{className:"ory-auth-title",children:r}),c&&t.jsx("p",{className:"ory-auth-description",children:c}),U&&t.jsx("p",{className:"ory-auth-error",children:U}),l.ui.messages?.length?t.jsx("div",{className:"ory-auth-error",children:l.ui.messages.map(a=>t.jsx("p",{children:a.text},a.id))}):null,l.ui.nodes.map(a=>{const e=a.attributes,i=`${l.id}-${e.name}`;if(e.type==="hidden")return t.jsx("input",{type:"hidden",name:e.name,value:String(e.value??"")},i);if(e.type==="submit"||e.type==="button")return null;const n=a.meta?.label?.text||e.name,o=j[e.name]??"";return t.jsxs("div",{className:"ory-auth-field",children:[t.jsx("label",{className:"ory-auth-label",htmlFor:e.name,children:n}),t.jsx("input",{id:e.name,name:e.name,type:e.name.toLowerCase().includes("email")?"email":e.type,className:"ory-auth-input",placeholder:e.placeholder,autoComplete:e.autocomplete,disabled:e.disabled,required:e.required,value:o,onChange:w=>F(e.name,w.target.value)}),a.messages?.map(w=>t.jsx("p",{className:"ory-auth-field-message",children:w.text},w.id))]},i)}),t.jsx("button",{type:"submit",className:"ory-auth-submit",children:u||B[s]}),d&&t.jsx("div",{className:"ory-auth-footer",children:d})]})})},D=()=>t.jsxs("div",{className:"ory-auth-links",children:[t.jsx("button",{type:"button",onClick:()=>m("registration"),children:"Create account"}),t.jsx("button",{type:"button",onClick:()=>m("recovery"),children:"Forgot password?"})]}),P=({title:s="Sign in",description:r="Enter your credentials to continue with your subscription.",submitLabel:c="Continue",footer:u,...h})=>t.jsx(v,{flowType:"login",title:s,description:r,submitLabel:c,footer:u??t.jsx(D,{}),...h}),V=()=>t.jsxs("div",{className:"ory-auth-links",children:[t.jsx("button",{type:"button",onClick:()=>m("login"),children:"Already have an account?"}),t.jsx("button",{type:"button",onClick:()=>m("recovery"),children:"Recover access"})]}),q=({title:s="Create your account",description:r="Provision access to the shared Ory identity platform.",submitLabel:c="Create account",footer:u,...h})=>t.jsx(v,{flowType:"registration",title:s,description:r,submitLabel:c,footer:u??t.jsx(V,{}),...h}),H=()=>t.jsxs("div",{className:"ory-auth-links",children:[t.jsx("button",{type:"button",onClick:()=>m("login"),children:"Back to login"}),t.jsx("button",{type:"button",onClick:()=>m("registration"),children:"Need an account?"})]}),M=({title:s="Recover access",description:r="Send yourself a magic link to reset your password.",submitLabel:c="Send recovery link",footer:u,...h})=>t.jsx(v,{flowType:"recovery",title:s,description:r,submitLabel:c,footer:u??t.jsx(H,{}),...h}),T=()=>{const[s,r]=f.useState(null),[c,u]=f.useState(!0),[h,p]=f.useState(null);return f.useEffect(()=>{let d=!0;return(async()=>{try{const g=A(),l=await b.get(`${g}/sessions/whoami`,{withCredentials:!0});if(!d)return;r(l.data),p(null)}catch(g){if(!d)return;b.isAxiosError(g)&&(g.response?.status===401||g.response?.status===403)?(r(null),p(null)):(r(null),p(g))}finally{d&&u(!1)}})(),()=>{d=!1}},[]),{session:s,loading:c,error:h}},W=({children:s,redirectTo:r="/login",loadingFallback:c,skipRedirect:u=!1})=>{const{session:h,loading:p}=T();if(p)return c??t.jsx("p",{children:"Checking session..."});if(!h&&!u){const d=r??"/login";let y;return/^https?:\/\//i.test(d)?y=d:d.startsWith("/")?y=`${window.location.origin}${d}`:y=`${window.location.origin}/${d}`,window.location.href=y,null}return s};exports.AuthFlow=v;exports.Login=P;exports.Recovery=M;exports.Registration=q;exports.RequireAuth=W;exports.getOryBrowserUrl=x;exports.getOryPublicApiBaseUrl=A;exports.getRedirectUrl=N;exports.openOryBrowserFlow=m;exports.useSession=T;
//# sourceMappingURL=index.cjs.map
