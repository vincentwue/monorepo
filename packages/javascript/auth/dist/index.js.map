{"version":3,"file":"index.js","sources":["../src/utils/ory.ts","../src/components/AuthFlow.tsx","../src/components/Login.tsx","../src/components/Registration.tsx","../src/components/Recovery.tsx","../src/components/useSession.tsx","../src/components/RequireAuth.tsx"],"sourcesContent":["import type { FlowType } from \"../types/flows\"\n\nconst DEFAULT_BROWSER_URL = \"http://localhost:4433\"\nconst DEFAULT_PUBLIC_API_URL = DEFAULT_BROWSER_URL\n\nexport const getOryBrowserUrl = () =>\n    import.meta.env?.VITE_ORY_BROWSER_URL?.replace(/\\/$/, \"\") || DEFAULT_BROWSER_URL\n\nexport const getOryPublicApiBaseUrl = () =>\n    import.meta.env?.VITE_ORY_PUBLIC_API_URL?.replace(/\\/$/, \"\") || DEFAULT_PUBLIC_API_URL\n\nexport const getRedirectUrl = (flowType: FlowType) => {\n    const env = import.meta.env\n    if (flowType === \"login\") return env?.VITE_AUTH_LOGIN_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/\"\n    if (flowType === \"registration\")\n        return env?.VITE_AUTH_REGISTRATION_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/\"\n    return env?.VITE_AUTH_RECOVERY_REDIRECT || env?.VITE_AUTH_SUCCESS_REDIRECT || \"/login\"\n}\n\nexport const openOryBrowserFlow = (flowType: FlowType, returnTo?: string) => {\n    const base = getOryBrowserUrl()\n    if (typeof window === \"undefined\") return\n    const url = new URL(`${base}/self-service/${flowType}/browser`)\n    if (returnTo) url.searchParams.set(\"return_to\", returnTo)\n    window.location.href = url.toString()\n}\n","import axios from \"axios\"\nimport type { FormEvent, ReactNode } from \"react\"\nimport { useEffect, useMemo, useState } from \"react\"\nimport { getOryBrowserUrl, getRedirectUrl, openOryBrowserFlow } from \"../utils/ory\"\nimport type { FlowType } from \"../types/flows\"\nimport \"../styles.css\"\n\ntype OryNode = {\n    attributes: {\n        name: string\n        type: string\n        value?: string | number | boolean\n        required?: boolean\n        disabled?: boolean\n        autocomplete?: string\n        pattern?: string\n        minLength?: number\n        maxLength?: number\n        placeholder?: string\n    }\n    meta?: {\n        label?: {\n            text?: string\n        }\n    }\n    messages?: { id: string | number; text: string }[]\n}\n\ntype OryFlow = {\n    id: string\n    ui: {\n        action: string\n        method: string\n        nodes: OryNode[]\n        messages?: { id: string | number; text: string }[]\n    }\n}\n\nconst DEFAULT_SUBMIT_LABEL: Record<FlowType, string> = {\n    login: \"Continue\",\n    registration: \"Create account\",\n    recovery: \"Send recovery link\",\n}\n\nexport interface AuthFlowProps {\n    flowType: FlowType\n    title?: string\n    description?: string\n    submitLabel?: string\n    className?: string\n    redirectTo?: string\n    footer?: ReactNode\n    onSuccess?: (payload: unknown) => void\n    onError?: (error: unknown) => void\n}\n\nexport const AuthFlow = ({\n    flowType,\n    title,\n    description,\n    submitLabel,\n    className,\n    redirectTo,\n    footer,\n    onError,\n    onSuccess,\n}: AuthFlowProps) => {\n    const [flow, setFlow] = useState<OryFlow | null>(null)\n    const [loading, setLoading] = useState(true)\n    const [formValues, setFormValues] = useState<Record<string, string>>({})\n    const [localError, setLocalError] = useState<string | null>(null)\n    const baseUrl = useMemo(() => getOryBrowserUrl(), [])\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return\n        let cancelled = false\n        const fetchFlow = async () => {\n            setLoading(true)\n            setLocalError(null)\n            try {\n                const params = new URLSearchParams(window.location.search)\n                const flowId = params.get(\"flow\")\n                if (!flowId) {\n                    openOryBrowserFlow(flowType, window.location.href)\n                    return\n                }\n\n                const res = await axios.get<OryFlow>(`${baseUrl}/self-service/${flowType}/flows`, {\n                    params: { id: flowId },\n                    withCredentials: true,\n                })\n\n                if (!cancelled) {\n                    setFlow(res.data)\n                }\n            } catch (error: any) {\n                console.error(`Failed to load ${flowType} flow`, error)\n                if (error?.response?.status === 404 || error?.response?.status === 410) {\n                    openOryBrowserFlow(flowType, window.location.href)\n                    return\n                }\n                setLocalError(\"Unable to reach the Ory backend. Check your env values.\")\n                onError?.(error)\n            } finally {\n                if (!cancelled) {\n                    setLoading(false)\n                }\n            }\n        }\n\n        fetchFlow()\n        return () => {\n            cancelled = true\n        }\n    }, [baseUrl, flowType, onError])\n\n    useEffect(() => {\n        if (!flow) return\n        setFormValues((prev) => {\n            const next = { ...prev }\n            flow.ui.nodes.forEach((node) => {\n                const { name, value } = node.attributes\n                if (value !== undefined && next[name] === undefined) {\n                    next[name] = String(value)\n                }\n            })\n            return next\n        })\n    }, [flow])\n\n    const handleChange = (key: string, value: string) => {\n        setFormValues((prev) => ({ ...prev, [key]: value }))\n    }\n\n    const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {\n        event.preventDefault()\n        if (!flow) return\n\n        const payload = new URLSearchParams()\n        Object.entries(formValues).forEach(([key, value]) => {\n            payload.set(key, value)\n        })\n\n        flow.ui.nodes\n            .filter((node) => node.attributes.type === \"hidden\")\n            .forEach((node) => {\n                const { name, value } = node.attributes\n                if (!name || value === undefined) return\n                if (!payload.has(name)) {\n                    payload.set(name, String(value))\n                }\n            })\n\n        const csrfNode = flow.ui.nodes.find((node) => node.attributes.name === \"csrf_token\")\n        if (csrfNode && !payload.get(\"csrf_token\") && csrfNode.attributes.value) {\n            payload.set(\"csrf_token\", String(csrfNode.attributes.value))\n        }\n\n        if (!payload.get(\"method\")) {\n            const methodNode = flow.ui.nodes.find((node) => node.attributes.name === \"method\")\n            if (methodNode?.attributes.value) {\n                payload.set(\"method\", String(methodNode.attributes.value))\n            } else if (flowType === \"login\") {\n                payload.set(\"method\", \"password\")\n            }\n        }\n\n        try {\n            const response = await axios.post(flow.ui.action, payload, {\n                withCredentials: true,\n                headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n            })\n\n            if (onSuccess) {\n                onSuccess(response.data)\n                return\n            }\n\n            const target = redirectTo || getRedirectUrl(flowType)\n            if (target && typeof window !== \"undefined\") {\n                window.location.assign(target)\n            }\n        } catch (error: any) {\n            console.error(\"Auth flow submission failed\", error)\n            onError?.(error)\n\n            const data = error?.response?.data\n            if (data?.ui) {\n                setFlow(data)\n                return\n            }\n\n            if (error?.response?.status === 410) {\n                openOryBrowserFlow(flowType, typeof window !== \"undefined\" ? window.location.href : undefined)\n                return\n            }\n\n            setLocalError(\"The credentials were rejected. Please try again.\")\n        }\n    }\n\n    if (loading || !flow) {\n        return (\n            <div className={`ory-auth-shell ${className ?? \"\"}`}>\n                <div className=\"ory-auth-panel\">\n                    <p className=\"ory-auth-loading\">Loading {flowType} flow...</p>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className={`ory-auth-shell ${className ?? \"\"}`}>\n            <form className=\"ory-auth-panel\" onSubmit={handleSubmit}>\n                {title && <h2 className=\"ory-auth-title\">{title}</h2>}\n                {description && <p className=\"ory-auth-description\">{description}</p>}\n\n                {localError && <p className=\"ory-auth-error\">{localError}</p>}\n\n                {flow.ui.messages?.length ? (\n                    <div className=\"ory-auth-error\">\n                        {flow.ui.messages.map((message) => (\n                            <p key={message.id}>{message.text}</p>\n                        ))}\n                    </div>\n                ) : null}\n\n                {flow.ui.nodes.map((node) => {\n                    const attr = node.attributes\n                    const key = `${flow.id}-${attr.name}`\n\n                    if (attr.type === \"hidden\") {\n                        return <input key={key} type=\"hidden\" name={attr.name} value={String(attr.value ?? \"\")} />\n                    }\n\n                    if (attr.type === \"submit\" || attr.type === \"button\") {\n                        return null\n                    }\n\n                    const label = node.meta?.label?.text || attr.name\n                    const currentValue = formValues[attr.name] ?? \"\"\n\n                    return (\n                        <div key={key} className=\"ory-auth-field\">\n                            <label className=\"ory-auth-label\" htmlFor={attr.name}>\n                                {label}\n                            </label>\n                            <input\n                                id={attr.name}\n                                name={attr.name}\n                                type={attr.name.toLowerCase().includes(\"email\") ? \"email\" : attr.type}\n                                className=\"ory-auth-input\"\n                                placeholder={attr.placeholder}\n                                autoComplete={attr.autocomplete}\n                                disabled={attr.disabled}\n                                required={attr.required}\n                                value={currentValue}\n                                onChange={(event) => handleChange(attr.name, event.target.value)}\n                            />\n                            {node.messages?.map((message) => (\n                                <p key={message.id} className=\"ory-auth-field-message\">\n                                    {message.text}\n                                </p>\n                            ))}\n                        </div>\n                    )\n                })}\n\n                <button type=\"submit\" className=\"ory-auth-submit\">\n                    {submitLabel || DEFAULT_SUBMIT_LABEL[flowType]}\n                </button>\n\n                {footer && <div className=\"ory-auth-footer\">{footer}</div>}\n            </form>\n        </div>\n    )\n}\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface LoginProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultLoginFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"registration\")}>\n            Create account\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"recovery\")}>\n            Forgot password?\n        </button>\n    </div>\n)\n\nexport const Login = ({\n    title = \"Sign in\",\n    description = \"Enter your credentials to continue with your subscription.\",\n    submitLabel = \"Continue\",\n    footer,\n    ...rest\n}: LoginProps) => (\n    <AuthFlow\n        flowType=\"login\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultLoginFooter />}\n        {...rest}\n    />\n)\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface RegistrationProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultRegistrationFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"login\")}>\n            Already have an account?\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"recovery\")}>\n            Recover access\n        </button>\n    </div>\n)\n\nexport const Registration = ({\n    title = \"Create your account\",\n    description = \"Provision access to the shared Ory identity platform.\",\n    submitLabel = \"Create account\",\n    footer,\n    ...rest\n}: RegistrationProps) => (\n    <AuthFlow\n        flowType=\"registration\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultRegistrationFooter />}\n        {...rest}\n    />\n)\n","import type { ReactNode } from \"react\"\nimport { AuthFlow, type AuthFlowProps } from \"./AuthFlow\"\nimport { openOryBrowserFlow } from \"../utils/ory\"\n\nexport interface RecoveryProps extends Omit<AuthFlowProps, \"flowType\"> {\n    footer?: ReactNode\n}\n\nconst DefaultRecoveryFooter = () => (\n    <div className=\"ory-auth-links\">\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"login\")}>\n            Back to login\n        </button>\n        <button type=\"button\" onClick={() => openOryBrowserFlow(\"registration\")}>\n            Need an account?\n        </button>\n    </div>\n)\n\nexport const Recovery = ({\n    title = \"Recover access\",\n    description = \"Send yourself a magic link to reset your password.\",\n    submitLabel = \"Send recovery link\",\n    footer,\n    ...rest\n}: RecoveryProps) => (\n    <AuthFlow\n        flowType=\"recovery\"\n        title={title}\n        description={description}\n        submitLabel={submitLabel}\n        footer={footer ?? <DefaultRecoveryFooter />}\n        {...rest}\n    />\n)\n","import { useEffect, useState } from \"react\"\nimport axios from \"axios\"\nimport { getOryPublicApiBaseUrl } from \"../utils/ory\"\n\nexport interface OrySession {\n    id: string\n    [key: string]: unknown\n}\n\nexport interface UseSessionResult {\n    session: OrySession | null\n    loading: boolean\n    error: unknown | null\n}\n\nexport const useSession = (): UseSessionResult => {\n    const [session, setSession] = useState<OrySession | null>(null)\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState<unknown | null>(null)\n\n    useEffect(() => {\n        let active = true\n\n        const fetchSession = async () => {\n            try {\n                const baseUrl = getOryPublicApiBaseUrl()\n                const response = await axios.get<OrySession>(`${baseUrl}/sessions/whoami`, {\n                    withCredentials: true,\n                })\n                if (!active) return\n                setSession(response.data)\n                setError(null)\n            } catch (err: unknown) {\n                if (!active) return\n                if (axios.isAxiosError(err) && (err.response?.status === 401 || err.response?.status === 403)) {\n                    setSession(null)\n                    setError(null)\n                } else {\n                    setSession(null)\n                    setError(err)\n                }\n            } finally {\n                if (active) {\n                    setLoading(false)\n                }\n            }\n        }\n\n        fetchSession()\n\n        return () => {\n            active = false\n        }\n    }, [])\n\n    return { session, loading, error }\n}\n","import type { JSX } from \"react\"\nimport { useSession } from \"./useSession\"\n\nexport interface RequireAuthProps {\n    children: JSX.Element\n    redirectTo?: string\n    loadingFallback?: JSX.Element\n}\n\n/**\n * RequireAuth\n *\n * - While loading: shows a small fallback.\n * - If unauthenticated: does a full-page redirect (window.location.href)\n *   to `redirectTo` (which can be absolute, e.g. http://localhost:5173/..., or\n *   a path like \"/login\").\n * - If authenticated: renders children.\n *\n * NOTE: We intentionally do NOT use React Router's <Navigate> here to avoid\n * cross-origin history.replaceState issues when redirecting to the auth-ui\n * (different port / origin).\n */\nexport const RequireAuth = ({\n    children,\n    redirectTo = \"/login\",\n    loadingFallback,\n    skipRedirect = false,\n}: RequireAuthProps) => {\n    const { session, loading } = useSession()\n\n    if (loading) {\n        return loadingFallback ?? <p>Checking session...</p>\n    }\n\n    if (!session && !skipRedirect) {\n        const target = redirectTo ?? \"/login\"\n\n        let finalUrl: string\n\n        if (/^https?:\\/\\//i.test(target)) {\n            // Absolute URL (can be different origin, e.g. auth-ui on 5173)\n            finalUrl = target\n        } else if (target.startsWith(\"/\")) {\n            // Path on the current origin\n            finalUrl = `${window.location.origin}${target}`\n        } else {\n            // Relative segment, normalize to \"/segment\"\n            finalUrl = `${window.location.origin}/${target}`\n        }\n\n\n        window.location.href = finalUrl\n        return null\n    }\n\n    return children\n}\n"],"names":["DEFAULT_BROWSER_URL","DEFAULT_PUBLIC_API_URL","getOryBrowserUrl","__vite_import_meta_env__","getOryPublicApiBaseUrl","getRedirectUrl","flowType","env","openOryBrowserFlow","returnTo","base","url","DEFAULT_SUBMIT_LABEL","AuthFlow","title","description","submitLabel","className","redirectTo","footer","onError","onSuccess","flow","setFlow","useState","loading","setLoading","formValues","setFormValues","localError","setLocalError","baseUrl","useMemo","useEffect","cancelled","flowId","res","axios","error","prev","next","node","name","value","handleChange","key","handleSubmit","event","payload","csrfNode","methodNode","response","target","data","jsx","jsxs","message","attr","label","currentValue","DefaultLoginFooter","Login","rest","DefaultRegistrationFooter","Registration","DefaultRecoveryFooter","Recovery","useSession","session","setSession","setError","active","err","RequireAuth","children","loadingFallback","skipRedirect","finalUrl"],"mappings":";;;cAEMA,IAAsB,yBACtBC,IAAyBD,GAElBE,IAAmB,MAC5BC,GAAiB,sBAAsB,QAAQ,OAAO,EAAE,KAAKH,GAEpDI,IAAyB,MAClCD,GAAiB,yBAAyB,QAAQ,OAAO,EAAE,KAAKF,GAEvDI,IAAiB,CAACC,MAAuB;AAClD,QAAMC,IAAMJ;AACZ,SAAIG,MAAa,UAAgBC,GAAK,4BAA4BA,GAAK,8BAA8B,MACjGD,MAAa,iBACNC,GAAK,mCAAmCA,GAAK,8BAA8B,MAC/EA,GAAK,+BAA+BA,GAAK,8BAA8B;AAClF,GAEaC,IAAqB,CAACF,GAAoBG,MAAsB;AACzE,QAAMC,IAAOR,EAAA;AACb,MAAI,OAAO,SAAW,IAAa;AACnC,QAAMS,IAAM,IAAI,IAAI,GAAGD,CAAI,iBAAiBJ,CAAQ,UAAU;AAC9D,EAAIG,KAAUE,EAAI,aAAa,IAAI,aAAaF,CAAQ,GACxD,OAAO,SAAS,OAAOE,EAAI,SAAA;AAC/B,GCaMC,IAAiD;AAAA,EACnD,OAAO;AAAA,EACP,cAAc;AAAA,EACd,UAAU;AACd,GAcaC,IAAW,CAAC;AAAA,EACrB,UAAAP;AAAA,EACA,OAAAQ;AAAA,EACA,aAAAC;AAAA,EACA,aAAAC;AAAA,EACA,WAAAC;AAAA,EACA,YAAAC;AAAA,EACA,QAAAC;AAAA,EACA,SAAAC;AAAA,EACA,WAAAC;AACJ,MAAqB;AACjB,QAAM,CAACC,GAAMC,CAAO,IAAIC,EAAyB,IAAI,GAC/C,CAACC,GAASC,CAAU,IAAIF,EAAS,EAAI,GACrC,CAACG,GAAYC,CAAa,IAAIJ,EAAiC,CAAA,CAAE,GACjE,CAACK,GAAYC,CAAa,IAAIN,EAAwB,IAAI,GAC1DO,IAAUC,EAAQ,MAAM9B,EAAA,GAAoB,CAAA,CAAE;AAEpD,EAAA+B,EAAU,MAAM;AACZ,QAAI,OAAO,SAAW,IAAa;AACnC,QAAIC,IAAY;AAmChB,YAlCkB,YAAY;AAC1B,MAAAR,EAAW,EAAI,GACfI,EAAc,IAAI;AAClB,UAAI;AAEA,cAAMK,IADS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnC,IAAI,MAAM;AAChC,YAAI,CAACA,GAAQ;AACT,UAAA3B,EAAmBF,GAAU,OAAO,SAAS,IAAI;AACjD;AAAA,QACJ;AAEA,cAAM8B,IAAM,MAAMC,EAAM,IAAa,GAAGN,CAAO,iBAAiBzB,CAAQ,UAAU;AAAA,UAC9E,QAAQ,EAAE,IAAI6B,EAAA;AAAA,UACd,iBAAiB;AAAA,QAAA,CACpB;AAED,QAAKD,KACDX,EAAQa,EAAI,IAAI;AAAA,MAExB,SAASE,GAAY;AAEjB,YADA,QAAQ,MAAM,kBAAkBhC,CAAQ,SAASgC,CAAK,GAClDA,GAAO,UAAU,WAAW,OAAOA,GAAO,UAAU,WAAW,KAAK;AACpE,UAAA9B,EAAmBF,GAAU,OAAO,SAAS,IAAI;AACjD;AAAA,QACJ;AACA,QAAAwB,EAAc,yDAAyD,GACvEV,IAAUkB,CAAK;AAAA,MACnB,UAAA;AACI,QAAKJ,KACDR,EAAW,EAAK;AAAA,MAExB;AAAA,IACJ,GAEA,GACO,MAAM;AACT,MAAAQ,IAAY;AAAA,IAChB;AAAA,EACJ,GAAG,CAACH,GAASzB,GAAUc,CAAO,CAAC,GAE/Ba,EAAU,MAAM;AACZ,IAAKX,KACLM,EAAc,CAACW,MAAS;AACpB,YAAMC,IAAO,EAAE,GAAGD,EAAA;AAClB,aAAAjB,EAAK,GAAG,MAAM,QAAQ,CAACmB,MAAS;AAC5B,cAAM,EAAE,MAAAC,GAAM,OAAAC,EAAA,IAAUF,EAAK;AAC7B,QAAIE,MAAU,UAAaH,EAAKE,CAAI,MAAM,WACtCF,EAAKE,CAAI,IAAI,OAAOC,CAAK;AAAA,MAEjC,CAAC,GACMH;AAAA,IACX,CAAC;AAAA,EACL,GAAG,CAAClB,CAAI,CAAC;AAET,QAAMsB,IAAe,CAACC,GAAaF,MAAkB;AACjD,IAAAf,EAAc,CAACW,OAAU,EAAE,GAAGA,GAAM,CAACM,CAAG,GAAGF,EAAA,EAAQ;AAAA,EACvD,GAEMG,IAAe,OAAOC,MAAsC;AAE9D,QADAA,EAAM,eAAA,GACF,CAACzB,EAAM;AAEX,UAAM0B,IAAU,IAAI,gBAAA;AACpB,WAAO,QAAQrB,CAAU,EAAE,QAAQ,CAAC,CAACkB,GAAKF,CAAK,MAAM;AACjD,MAAAK,EAAQ,IAAIH,GAAKF,CAAK;AAAA,IAC1B,CAAC,GAEDrB,EAAK,GAAG,MACH,OAAO,CAACmB,MAASA,EAAK,WAAW,SAAS,QAAQ,EAClD,QAAQ,CAACA,MAAS;AACf,YAAM,EAAE,MAAAC,GAAM,OAAAC,EAAA,IAAUF,EAAK;AAC7B,MAAI,CAACC,KAAQC,MAAU,UAClBK,EAAQ,IAAIN,CAAI,KACjBM,EAAQ,IAAIN,GAAM,OAAOC,CAAK,CAAC;AAAA,IAEvC,CAAC;AAEL,UAAMM,IAAW3B,EAAK,GAAG,MAAM,KAAK,CAACmB,MAASA,EAAK,WAAW,SAAS,YAAY;AAKnF,QAJIQ,KAAY,CAACD,EAAQ,IAAI,YAAY,KAAKC,EAAS,WAAW,SAC9DD,EAAQ,IAAI,cAAc,OAAOC,EAAS,WAAW,KAAK,CAAC,GAG3D,CAACD,EAAQ,IAAI,QAAQ,GAAG;AACxB,YAAME,IAAa5B,EAAK,GAAG,MAAM,KAAK,CAACmB,MAASA,EAAK,WAAW,SAAS,QAAQ;AACjF,MAAIS,GAAY,WAAW,QACvBF,EAAQ,IAAI,UAAU,OAAOE,EAAW,WAAW,KAAK,CAAC,IAClD5C,MAAa,WACpB0C,EAAQ,IAAI,UAAU,UAAU;AAAA,IAExC;AAEA,QAAI;AACA,YAAMG,IAAW,MAAMd,EAAM,KAAKf,EAAK,GAAG,QAAQ0B,GAAS;AAAA,QACvD,iBAAiB;AAAA,QACjB,SAAS,EAAE,gBAAgB,oCAAA;AAAA,MAAoC,CAClE;AAED,UAAI3B,GAAW;AACX,QAAAA,EAAU8B,EAAS,IAAI;AACvB;AAAA,MACJ;AAEA,YAAMC,IAASlC,KAAcb,EAAeC,CAAQ;AACpD,MAAI8C,KAAU,OAAO,SAAW,OAC5B,OAAO,SAAS,OAAOA,CAAM;AAAA,IAErC,SAASd,GAAY;AACjB,cAAQ,MAAM,+BAA+BA,CAAK,GAClDlB,IAAUkB,CAAK;AAEf,YAAMe,IAAOf,GAAO,UAAU;AAC9B,UAAIe,GAAM,IAAI;AACV,QAAA9B,EAAQ8B,CAAI;AACZ;AAAA,MACJ;AAEA,UAAIf,GAAO,UAAU,WAAW,KAAK;AACjC,QAAA9B,EAAmBF,GAAU,OAAO,SAAW,MAAc,OAAO,SAAS,OAAO,MAAS;AAC7F;AAAA,MACJ;AAEA,MAAAwB,EAAc,kDAAkD;AAAA,IACpE;AAAA,EACJ;AAEA,SAAIL,KAAW,CAACH,IAER,gBAAAgC,EAAC,OAAA,EAAI,WAAW,kBAAkBrC,KAAa,EAAE,IAC7C,UAAA,gBAAAqC,EAAC,OAAA,EAAI,WAAU,kBACX,UAAA,gBAAAC,EAAC,KAAA,EAAE,WAAU,oBAAmB,UAAA;AAAA,IAAA;AAAA,IAASjD;AAAA,IAAS;AAAA,EAAA,EAAA,CAAQ,GAC9D,GACJ,IAKJ,gBAAAgD,EAAC,OAAA,EAAI,WAAW,kBAAkBrC,KAAa,EAAE,IAC7C,UAAA,gBAAAsC,EAAC,QAAA,EAAK,WAAU,kBAAiB,UAAUT,GACtC,UAAA;AAAA,IAAAhC,KAAS,gBAAAwC,EAAC,MAAA,EAAG,WAAU,kBAAkB,UAAAxC,GAAM;AAAA,IAC/CC,KAAe,gBAAAuC,EAAC,KAAA,EAAE,WAAU,wBAAwB,UAAAvC,GAAY;AAAA,IAEhEc,KAAc,gBAAAyB,EAAC,KAAA,EAAE,WAAU,kBAAkB,UAAAzB,GAAW;AAAA,IAExDP,EAAK,GAAG,UAAU,2BACd,OAAA,EAAI,WAAU,kBACV,UAAAA,EAAK,GAAG,SAAS,IAAI,CAACkC,wBAClB,KAAA,EAAoB,UAAAA,EAAQ,QAArBA,EAAQ,EAAkB,CACrC,EAAA,CACL,IACA;AAAA,IAEHlC,EAAK,GAAG,MAAM,IAAI,CAACmB,MAAS;AACzB,YAAMgB,IAAOhB,EAAK,YACZI,IAAM,GAAGvB,EAAK,EAAE,IAAImC,EAAK,IAAI;AAEnC,UAAIA,EAAK,SAAS;AACd,eAAO,gBAAAH,EAAC,SAAA,EAAgB,MAAK,UAAS,MAAMG,EAAK,MAAM,OAAO,OAAOA,EAAK,SAAS,EAAE,KAAlEZ,CAAqE;AAG5F,UAAIY,EAAK,SAAS,YAAYA,EAAK,SAAS;AACxC,eAAO;AAGX,YAAMC,IAAQjB,EAAK,MAAM,OAAO,QAAQgB,EAAK,MACvCE,IAAehC,EAAW8B,EAAK,IAAI,KAAK;AAE9C,aACI,gBAAAF,EAAC,OAAA,EAAc,WAAU,kBACrB,UAAA;AAAA,QAAA,gBAAAD,EAAC,WAAM,WAAU,kBAAiB,SAASG,EAAK,MAC3C,UAAAC,GACL;AAAA,QACA,gBAAAJ;AAAA,UAAC;AAAA,UAAA;AAAA,YACG,IAAIG,EAAK;AAAA,YACT,MAAMA,EAAK;AAAA,YACX,MAAMA,EAAK,KAAK,YAAA,EAAc,SAAS,OAAO,IAAI,UAAUA,EAAK;AAAA,YACjE,WAAU;AAAA,YACV,aAAaA,EAAK;AAAA,YAClB,cAAcA,EAAK;AAAA,YACnB,UAAUA,EAAK;AAAA,YACf,UAAUA,EAAK;AAAA,YACf,OAAOE;AAAA,YACP,UAAU,CAACZ,MAAUH,EAAaa,EAAK,MAAMV,EAAM,OAAO,KAAK;AAAA,UAAA;AAAA,QAAA;AAAA,QAElEN,EAAK,UAAU,IAAI,CAACe,MACjB,gBAAAF,EAAC,KAAA,EAAmB,WAAU,0BACzB,UAAAE,EAAQ,KAAA,GADLA,EAAQ,EAEhB,CACH;AAAA,MAAA,EAAA,GApBKX,CAqBV;AAAA,IAER,CAAC;AAAA,IAED,gBAAAS,EAAC,YAAO,MAAK,UAAS,WAAU,mBAC3B,UAAAtC,KAAeJ,EAAqBN,CAAQ,EAAA,CACjD;AAAA,IAECa,KAAU,gBAAAmC,EAAC,OAAA,EAAI,WAAU,mBAAmB,UAAAnC,EAAA,CAAO;AAAA,EAAA,EAAA,CACxD,EAAA,CACJ;AAER,GC5QMyC,IAAqB,MACvB,gBAAAL,EAAC,OAAA,EAAI,WAAU,kBACX,UAAA;AAAA,EAAA,gBAAAD,EAAC,UAAA,EAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,cAAc,GAAG,UAAA,iBAAA,CAEzE;AAAA,EACA,gBAAA8C,EAAC,YAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,UAAU,GAAG,UAAA,mBAAA,CAErE;AAAA,GACJ,GAGSqD,IAAQ,CAAC;AAAA,EAClB,OAAA/C,IAAQ;AAAA,EACR,aAAAC,IAAc;AAAA,EACd,aAAAC,IAAc;AAAA,EACd,QAAAG;AAAA,EACA,GAAG2C;AACP,MACI,gBAAAR;AAAA,EAACzC;AAAA,EAAA;AAAA,IACG,UAAS;AAAA,IACT,OAAAC;AAAA,IACA,aAAAC;AAAA,IACA,aAAAC;AAAA,IACA,QAAQG,KAAU,gBAAAmC,EAACM,GAAA,CAAA,CAAmB;AAAA,IACrC,GAAGE;AAAA,EAAA;AACR,GCzBEC,IAA4B,MAC9B,gBAAAR,EAAC,OAAA,EAAI,WAAU,kBACX,UAAA;AAAA,EAAA,gBAAAD,EAAC,UAAA,EAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,OAAO,GAAG,UAAA,2BAAA,CAElE;AAAA,EACA,gBAAA8C,EAAC,YAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,UAAU,GAAG,UAAA,iBAAA,CAErE;AAAA,GACJ,GAGSwD,IAAe,CAAC;AAAA,EACzB,OAAAlD,IAAQ;AAAA,EACR,aAAAC,IAAc;AAAA,EACd,aAAAC,IAAc;AAAA,EACd,QAAAG;AAAA,EACA,GAAG2C;AACP,MACI,gBAAAR;AAAA,EAACzC;AAAA,EAAA;AAAA,IACG,UAAS;AAAA,IACT,OAAAC;AAAA,IACA,aAAAC;AAAA,IACA,aAAAC;AAAA,IACA,QAAQG,KAAU,gBAAAmC,EAACS,GAAA,CAAA,CAA0B;AAAA,IAC5C,GAAGD;AAAA,EAAA;AACR,GCzBEG,IAAwB,MAC1B,gBAAAV,EAAC,OAAA,EAAI,WAAU,kBACX,UAAA;AAAA,EAAA,gBAAAD,EAAC,UAAA,EAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,OAAO,GAAG,UAAA,gBAAA,CAElE;AAAA,EACA,gBAAA8C,EAAC,YAAO,MAAK,UAAS,SAAS,MAAM9C,EAAmB,cAAc,GAAG,UAAA,mBAAA,CAEzE;AAAA,GACJ,GAGS0D,IAAW,CAAC;AAAA,EACrB,OAAApD,IAAQ;AAAA,EACR,aAAAC,IAAc;AAAA,EACd,aAAAC,IAAc;AAAA,EACd,QAAAG;AAAA,EACA,GAAG2C;AACP,MACI,gBAAAR;AAAA,EAACzC;AAAA,EAAA;AAAA,IACG,UAAS;AAAA,IACT,OAAAC;AAAA,IACA,aAAAC;AAAA,IACA,aAAAC;AAAA,IACA,QAAQG,KAAU,gBAAAmC,EAACW,GAAA,CAAA,CAAsB;AAAA,IACxC,GAAGH;AAAA,EAAA;AACR,GClBSK,IAAa,MAAwB;AAC9C,QAAM,CAACC,GAASC,CAAU,IAAI7C,EAA4B,IAAI,GACxD,CAACC,GAASC,CAAU,IAAIF,EAAS,EAAI,GACrC,CAACc,GAAOgC,CAAQ,IAAI9C,EAAyB,IAAI;AAEvD,SAAAS,EAAU,MAAM;AACZ,QAAIsC,IAAS;AA2Bb,YAzBqB,YAAY;AAC7B,UAAI;AACA,cAAMxC,IAAU3B,EAAA,GACV+C,IAAW,MAAMd,EAAM,IAAgB,GAAGN,CAAO,oBAAoB;AAAA,UACvE,iBAAiB;AAAA,QAAA,CACpB;AACD,YAAI,CAACwC,EAAQ;AACb,QAAAF,EAAWlB,EAAS,IAAI,GACxBmB,EAAS,IAAI;AAAA,MACjB,SAASE,GAAc;AACnB,YAAI,CAACD,EAAQ;AACb,QAAIlC,EAAM,aAAamC,CAAG,MAAMA,EAAI,UAAU,WAAW,OAAOA,EAAI,UAAU,WAAW,QACrFH,EAAW,IAAI,GACfC,EAAS,IAAI,MAEbD,EAAW,IAAI,GACfC,EAASE,CAAG;AAAA,MAEpB,UAAA;AACI,QAAID,KACA7C,EAAW,EAAK;AAAA,MAExB;AAAA,IACJ,GAEA,GAEO,MAAM;AACT,MAAA6C,IAAS;AAAA,IACb;AAAA,EACJ,GAAG,CAAA,CAAE,GAEE,EAAE,SAAAH,GAAS,SAAA3C,GAAS,OAAAa,EAAA;AAC/B,GClCamC,IAAc,CAAC;AAAA,EACxB,UAAAC;AAAA,EACA,YAAAxD,IAAa;AAAA,EACb,iBAAAyD;AAAA,EACA,cAAAC,IAAe;AACnB,MAAwB;AACpB,QAAM,EAAE,SAAAR,GAAS,SAAA3C,EAAA,IAAY0C,EAAA;AAE7B,MAAI1C;AACA,WAAOkD,KAAmB,gBAAArB,EAAC,KAAA,EAAE,UAAA,sBAAA,CAAmB;AAGpD,MAAI,CAACc,KAAW,CAACQ,GAAc;AAC3B,UAAMxB,IAASlC,KAAc;AAE7B,QAAI2D;AAEJ,WAAI,gBAAgB,KAAKzB,CAAM,IAE3ByB,IAAWzB,IACJA,EAAO,WAAW,GAAG,IAE5ByB,IAAW,GAAG,OAAO,SAAS,MAAM,GAAGzB,CAAM,KAG7CyB,IAAW,GAAG,OAAO,SAAS,MAAM,IAAIzB,CAAM,IAIlD,OAAO,SAAS,OAAOyB,GAChB;AAAA,EACX;AAEA,SAAOH;AACX;"}